<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Unity WebGL Player</title>
    <style>
        body { margin: 0; overflow: hidden; }
    </style>
</head>
<body>
    <script>
        // Unityのビルドデータをロードする
        var buildUrl = "Build";
        var loaderUrl = buildUrl + "/nogzip.loader.js";
        var config = {
            dataUrl: buildUrl + "/nogzip.data",
            frameworkUrl: buildUrl + "/nogzip.framework.js",
            codeUrl: buildUrl + "/nogzip.wasm",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "DefaultCompany",
            productName: "maze2",
            productVersion: "0.1",
        };

        var container = document.createElement("div");
        container.id = "unity-container";
        document.body.appendChild(container);

        var canvas = document.createElement("canvas");
        container.appendChild(canvas);

        var loadingBar = document.createElement("div");
        loadingBar.id = "loading-bar";
        container.appendChild(loadingBar);

        var progressBarFull = document.createElement("div");
        progressBarFull.id = "progress-bar-full";
        loadingBar.appendChild(progressBarFull);

        var unityInstance = UnityLoader.instantiate("unity-container", loaderUrl, config);

        // ジャイロデータをUnityに送信する
        function handleOrientation(event) {
            var rotationX = event.beta / 180 * Math.PI; // X軸の回転
            var rotationZ = event.gamma / 180 * Math.PI; // Z軸の回転
            unityInstance.SendMessage('Plane', 'UpdateRotation', rotationX + ',' + rotationZ);
        }

        // ジャイロセンサーの使用許可をリクエスト
        function requestGyroAccess() {
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission()
                    .then(response => {
                        if (response === 'granted') {
                            window.addEventListener("deviceorientation", handleOrientation);
                        } else {
                            alert('Gyroscope access denied');
                        }
                    })
                    .catch(console.error);
            } else {
                window.addEventListener("deviceorientation", handleOrientation);
            }
        }

        // ボタンを作成して、ユーザーにジャイロセンサーの使用許可をリクエスト
        var button = document.createElement("button");
        button.innerHTML = "Enable Gyroscope";
        button.style.position = "absolute";
        button.style.top = "10px";
        button.style.left = "10px";
        button.style.zIndex = 1000;
        button.onclick = function() {
            requestGyroAccess();
            document.body.removeChild(button);
        };
        document.body.appendChild(button);
    </script>
</body>
</html>
